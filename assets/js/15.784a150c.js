(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{396:function(e,t,v){"use strict";v.r(t);var _=v(25),s=Object(_.a)({},(function(){var e=this,t=e.$createElement,v=e._self._c||t;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h1",{attrs:{id:"数据库"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#数据库"}},[e._v("#")]),e._v(" 数据库 (Database)")]),e._v(" "),v("h2",{attrs:{id:"全局接口"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#全局接口"}},[e._v("#")]),e._v(" 全局接口")]),e._v(" "),v("h3",{attrs:{id:"user-flag"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#user-flag"}},[e._v("#")]),e._v(" User.Flag")]),e._v(" "),v("p",[e._v("所有用户状态标签构成的枚举类型。参见 "),v("RouterLink",{attrs:{to:"/guide/authorization.html#状态标签"}},[e._v("状态标签")]),e._v("。")],1),e._v(" "),v("h3",{attrs:{id:"user-fields"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#user-fields"}},[e._v("#")]),e._v(" User.fields")]),e._v(" "),v("p",[e._v("所有用户字段构成的列表。")]),e._v(" "),v("h3",{attrs:{id:"user-extend"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#user-extend"}},[e._v("#")]),e._v(" User.extend(getter)")]),e._v(" "),v("p",[e._v("扩展用户字段。")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("getter:")]),e._v(" "),v("code",[e._v("(id: number, authority: number) => object")]),e._v(" 新字段的初始化函数，返回值应该是一个由要扩展的字段和它们的默认值构成的键值对")]),e._v(" "),v("li",[e._v("返回值: "),v("code",[e._v("void")])])]),e._v(" "),v("h3",{attrs:{id:"user-create"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#user-create"}},[e._v("#")]),e._v(" User.create(id, authority)")]),e._v(" "),v("p",[e._v("创建一个新用户数据对象。")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("id:")]),e._v(" "),v("code",[e._v("number")]),e._v(" 用户 ID")]),e._v(" "),v("li",[v("strong",[e._v("authority:")]),e._v(" "),v("code",[e._v("number")]),e._v(" 权限等级")]),e._v(" "),v("li",[e._v("返回值: "),v("code",[e._v("UserData")])])]),e._v(" "),v("h3",{attrs:{id:"group-flag"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#group-flag"}},[e._v("#")]),e._v(" Group.Flag")]),e._v(" "),v("p",[e._v("所有群状态标签构成的枚举类型。参见 "),v("RouterLink",{attrs:{to:"/guide/authorization.html#状态标签"}},[e._v("状态标签")]),e._v("。")],1),e._v(" "),v("h3",{attrs:{id:"group-fields"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#group-fields"}},[e._v("#")]),e._v(" Group.fields")]),e._v(" "),v("p",[e._v("所有群字段构成的列表。")]),e._v(" "),v("h3",{attrs:{id:"group-extend"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#group-extend"}},[e._v("#")]),e._v(" Group.extend(getter)")]),e._v(" "),v("p",[e._v("扩展群字段。")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("getter:")]),e._v(" "),v("code",[e._v("(id: number, assignee: number) => object")]),e._v(" 新字段的初始化函数，返回值应该是一个由要扩展的字段和它们的默认值构成的键值对")]),e._v(" "),v("li",[e._v("返回值: "),v("code",[e._v("void")])])]),e._v(" "),v("h3",{attrs:{id:"group-create"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#group-create"}},[e._v("#")]),e._v(" Group.create(id, assignee)")]),e._v(" "),v("p",[e._v("创建一个新群数据对象。")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("id:")]),e._v(" "),v("code",[e._v("number")]),e._v(" 用户 ID")]),e._v(" "),v("li",[v("strong",[e._v("assignee:")]),e._v(" "),v("code",[e._v("number")]),e._v(" 代理者的 ID")]),e._v(" "),v("li",[e._v("返回值: "),v("code",[e._v("GroupData")])])]),e._v(" "),v("h3",{attrs:{id:"extenddatabase"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#extenddatabase"}},[e._v("#")]),e._v(" extendDatabase(database, extension)")]),e._v(" "),v("p",[e._v("扩展一个数据库的方法。")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("database:")]),e._v(" "),v("code",[e._v("string | (new () => Database)")]),e._v(" 要扩展的数据库类；如果传入一个字符串，则会将这个模块的默认导出作为目标类")]),e._v(" "),v("li",[v("strong",[e._v("extension:")]),e._v(" "),v("code",[e._v("Partial<Database>")]),e._v(" 要添加到原型链的方法")])]),e._v(" "),v("h2",{attrs:{id:"数据库对象"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#数据库对象"}},[e._v("#")]),e._v(" 数据库对象")]),e._v(" "),v("p",[e._v("一个 Database 对象代理了 Koishi 上下文绑定的应用实例有关的所有数据库访问。同时它具有注入特性，任何插件都可以自己定义数据库上的方法。本章主要介绍数据库的官方接口。注意："),v("strong",[e._v("它们并不由 Koishi 自身实现，而是由每个数据库分别实现的")]),e._v("。Koishi 只是提供了一套标准。")]),e._v(" "),v("h3",{attrs:{id:"db-getuser"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#db-getuser"}},[e._v("#")]),e._v(" db.getUser(userId, defaultAuthority?, fields?)")]),e._v(" "),v("p",[e._v("向数据库请求用户数据。其中的后两个参数可以写任意一个，都可以识别。如果对应的用户不存在，且默认权限非负，则立即生成一个用户对象返回；如果默认权限为正数，则将生成的用户对象写入数据库。")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("userId:")]),e._v(" "),v("code",[e._v("number")]),e._v(" 用户 ID")]),e._v(" "),v("li",[v("strong",[e._v("defaultAuthority:")]),e._v(" "),v("code",[e._v("number")]),e._v(" 默认权限，默认值为 "),v("code",[e._v("0")])]),e._v(" "),v("li",[v("strong",[e._v("fields:")]),e._v(" "),v("code",[e._v("UserField[]")]),e._v(" 请求的字段，默认为全部字段")]),e._v(" "),v("li",[e._v("返回值: "),v("code",[e._v("Promise<Partial<UserData>>")]),e._v(" 用户数据")])]),e._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[e._v("提示")]),e._v(" "),v("p",[e._v("尽管这里我们提供了 "),v("code",[e._v("fields")]),e._v(" 参数用于对特定的数据库进行优化，但是如果你是数据库开发者，也完全可以忽略这个参数。只需要保证返回的数据满足用户数据格式，且包含在 "),v("code",[e._v("fields")]),e._v(" 中的字段都存在即可。")])]),e._v(" "),v("h3",{attrs:{id:"db-getusers"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#db-getusers"}},[e._v("#")]),e._v(" db.getUsers(ids?, fields?)")]),e._v(" "),v("p",[e._v("向数据库请求多位用户数据。如果数据不存在，则不会在返回的列表中。")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("ids:")]),e._v(" "),v("code",[e._v("number[]")]),e._v(" 用户 ID 列表，默认为全部用户")]),e._v(" "),v("li",[v("strong",[e._v("fields:")]),e._v(" "),v("code",[e._v("UserField[]")]),e._v(" 请求的字段，默认为全部字段")]),e._v(" "),v("li",[e._v("返回值: "),v("code",[e._v("Promise<Partial<UserData>[]>")]),e._v(" 用户数据列表")])]),e._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[e._v("提示")]),e._v(" "),v("p",[e._v("这里的两个参数可以写任意一个，都可以识别。虽然这两个参数都是数组类型，但是可以利用 "),v("code",[e._v("ids")]),e._v(" 中的元素一定是数字而 "),v("code",[e._v("fields")]),e._v(" 中的元素一定是字符串进行判断。")])]),e._v(" "),v("h3",{attrs:{id:"db-setuser"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#db-setuser"}},[e._v("#")]),e._v(" db.setUser(id, data)")]),e._v(" "),v("p",[e._v("向数据库写入用户数据。")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("id:")]),e._v(" "),v("code",[e._v("number")]),e._v(" 用户 ID")]),e._v(" "),v("li",[v("strong",[e._v("data:")]),e._v(" "),v("code",[e._v("Partial<UserData>")]),e._v(" 要修改的数据")]),e._v(" "),v("li",[e._v("返回值: "),v("code",[e._v("Promise<any>")])])]),e._v(" "),v("h3",{attrs:{id:"db-getgroup"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#db-getgroup"}},[e._v("#")]),e._v(" db.getGroup(groupId, assignee?, fields?)")]),e._v(" "),v("p",[e._v("向数据库请求群数据。其中的后两个参数可以写任意一个，都可以识别。如果对应的群不存在，则立即生成一个群对象返回；且如果默认代理者为正数，则将生成的群对象写回数据库。")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("groupId:")]),e._v(" "),v("code",[e._v("number")]),e._v(" 群 ID")]),e._v(" "),v("li",[v("strong",[e._v("assignee:")]),e._v(" "),v("code",[e._v("number")]),e._v(" 默认代理者，默认为 "),v("code",[e._v("0")])]),e._v(" "),v("li",[v("strong",[e._v("fields:")]),e._v(" "),v("code",[e._v("GroupField[]")]),e._v(" 请求的字段，默认为全部字段")]),e._v(" "),v("li",[e._v("返回值: "),v("code",[e._v("Promise<Partial<GroupData>>")]),e._v(" 群数据")])]),e._v(" "),v("h3",{attrs:{id:"db-getallgroups"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#db-getallgroups"}},[e._v("#")]),e._v(" db.getAllGroups(fields?, assignees?)")]),e._v(" "),v("p",[e._v("向数据库请求被特定机器人管理的所有群数据。这里的两个参数可以写任意一个，都可以识别。")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("fields:")]),e._v(" "),v("code",[e._v("GroupField[]")]),e._v(" 请求的字段，默认为全部字段")]),e._v(" "),v("li",[v("strong",[e._v("assignees:")]),e._v(" "),v("code",[e._v("number[]")]),e._v(" 机器人 ID 列表，默认为当前进程全部机器人")]),e._v(" "),v("li",[e._v("返回值: "),v("code",[e._v("Promise<Partial<GroupData>[]>")]),e._v(" 群数据列表")])]),e._v(" "),v("div",{staticClass:"custom-block warning"},[v("p",{staticClass:"custom-block-title"},[e._v("注意")]),e._v(" "),v("p",[e._v("请注意这个方法和上面的 "),v("code",[e._v("db.getUsers")]),e._v(" 方法的区别。除了名字不同以外，这个方法的 "),v("code",[e._v("fields")]),e._v(" 是第一个参数，且 "),v("code",[e._v("assignees")]),e._v(" 代表的是机器人 ID 列表；而上面的 "),v("code",[e._v("db.getUsers()")]),e._v(" 方法的第一个参数是 "),v("code",[e._v("ids")]),e._v("，且代表的是用户 ID 列表。")])]),e._v(" "),v("h3",{attrs:{id:"db-setgroup"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#db-setgroup"}},[e._v("#")]),e._v(" db.setGroup(id, data)")]),e._v(" "),v("p",[e._v("向数据库写入群数据。")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("id:")]),e._v(" "),v("code",[e._v("number")]),e._v(" 群 ID")]),e._v(" "),v("li",[v("strong",[e._v("data:")]),e._v(" "),v("code",[e._v("Partial<GroupData>")]),e._v(" 要修改的数据")]),e._v(" "),v("li",[e._v("返回值: "),v("code",[e._v("Promise<any>")])])])])}),[],!1,null,null,null);t.default=s.exports}}]);