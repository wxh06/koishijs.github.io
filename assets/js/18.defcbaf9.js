(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{374:function(t,e,a){"use strict";a.r(e);var s=a(25),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"接收器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#接收器"}},[t._v("#")]),t._v(" 接收器 (Receiver)")]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("这里是"),a("strong",[t._v("正在施工")]),t._v("的 koishi v2 的文档。要查看 v1 版本的文档，请前往"),a("a",{attrs:{href:"https://koishijs.github.io/v1/",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[t._v("这里")]),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("p",[t._v("一个接收器是一个 "),a("a",{attrs:{href:"https://nodejs.org/api/events.html#events_class_eventemitter",target:"_blank",rel:"noopener noreferrer"}},[t._v("EventEmitter"),a("OutboundLink")],1),t._v(" 实例，其上封装了所有 "),a("a",{attrs:{href:"https://cqhttp.cc/docs/4.12/#/Post",target:"_blank",rel:"noopener noreferrer"}},[t._v("CQHTTP 事件"),a("OutboundLink")],1),t._v("，并添加了一些专用于 Koishi 的事件。不同的事件可能触发在不同的上下文上。")]),t._v(" "),a("h2",{attrs:{id:"事件：message"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：message"}},[t._v("#")]),t._v(" 事件：message")]),t._v(" "),a("p",[t._v("message 事件发生在机器人收到信息时，它会在相应的上下文触发。例如，一个发生在群 123 的 message 事件会有以下的触发效果：")]),t._v(" "),a("panel-view",{staticClass:"code",attrs:{title:""}},[a("pre",{staticClass:"shiki",staticStyle:{"background-color":"#272822"}},[a("code",[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("app.receiver.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("on")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'message'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", callback) ")]),a("span",{staticStyle:{color:"#75715E"}},[t._v("// 触发")]),t._v("\n"),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("app.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("group")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#AE81FF"}},[t._v("123")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(").receiver.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("on")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'message'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", callback) ")]),a("span",{staticStyle:{color:"#75715E"}},[t._v("// 触发")]),t._v("\n"),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("app.groups.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("except")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#AE81FF"}},[t._v("456")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(").receiver.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("on")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'message'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", callback) ")]),a("span",{staticStyle:{color:"#75715E"}},[t._v("// 触发")]),t._v("\n\n"),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("app.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("group")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#AE81FF"}},[t._v("456")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(").receiver.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("on")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'message'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", callback) ")]),a("span",{staticStyle:{color:"#75715E"}},[t._v("// 不触发")]),t._v("\n"),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("app.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("user")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#AE81FF"}},[t._v("123")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(").receiver.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("on")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'message'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", callback) ")]),a("span",{staticStyle:{color:"#75715E"}},[t._v("// 不触发")]),t._v("\n"),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("app.discusses.receiver.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("on")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'message'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", callback) ")]),a("span",{staticStyle:{color:"#75715E"}},[t._v("// 不触发")])])])]),a("p",[t._v("message 事件还拥有以下的子事件：")]),t._v(" "),a("ul",[a("li",[t._v("message/normal: 普通群聊天信息")]),t._v(" "),a("li",[t._v("message/anonymous: 匿名群聊天信息")]),t._v(" "),a("li",[t._v("message/notice: 群提醒信息")]),t._v(" "),a("li",[t._v("message/friend: 好友私聊信息")]),t._v(" "),a("li",[t._v("message/group: 群友私聊信息")]),t._v(" "),a("li",[t._v("message/discuss: 讨论组私聊信息")]),t._v(" "),a("li",[t._v("message/other: 其他私聊信息")])]),t._v(" "),a("p",[t._v("所有的 message 事件的回调函数都会传入一个 "),a("RouterLink",{attrs:{to:"/guide/message.html#深入-meta-对象"}},[a("code",[t._v("Meta")]),t._v(" 对象")]),t._v("。")],1),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("message/group 表示"),a("strong",[t._v("由非好友的群友发起的私聊信息，并不是群聊信息")]),t._v("，请注意区分。群聊信息与其他信息的区分直接通过上下文而不是子事件实现。message/discuss 同理。")])]),t._v(" "),a("h2",{attrs:{id:"事件：request"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：request"}},[t._v("#")]),t._v(" 事件：request")]),t._v(" "),a("p",[t._v("request 事件发生于机器人收到请求时，会在相应的上下文触发。所有的 request 事件的回调函数都会传入一个 "),a("RouterLink",{attrs:{to:"/guide/message.html#深入-meta-对象"}},[a("code",[t._v("Meta")]),t._v(" 对象")]),t._v("。这个事件"),a("strong",[t._v("本身不会触发")]),t._v("，只会通过以下子事件的形式触发：")],1),t._v(" "),a("ul",[a("li",[t._v("request/friend: 好友申请")]),t._v(" "),a("li",[t._v("request/group/add: 加群申请")]),t._v(" "),a("li",[t._v("request/group/invite: 群邀请")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("如果与 "),a("RouterLink",{attrs:{to:"/api/sender.html"}},[t._v("Sender API")]),t._v(" 进行比对，你会发现这里有一个小坑：request/friend 事件对应着 "),a("code",[t._v("sender.setFriendAddRequest()")]),t._v("，而两种 request/group 事件都对应着 "),a("code",[t._v("sender.setGroupAddRequest()")]),t._v("，并没有 "),a("code",[t._v("sender.setGroupInviteRequest()")]),t._v(" 这个方法，也就是说 Sender API 中的 add 与这里的 subType 是没有关系的！")],1)]),t._v(" "),a("h2",{attrs:{id:"notice-系列事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#notice-系列事件"}},[t._v("#")]),t._v(" notice 系列事件")]),t._v(" "),a("p",[t._v("notice 系列事件发生于机器人收到提醒时，会在相应的上下文触发。所有这些事件的回调函数都会传入一个 "),a("RouterLink",{attrs:{to:"/guide/message.html#深入-meta-对象"}},[a("code",[t._v("Meta")]),t._v(" 对象")]),t._v("。这些事件的共同点是 "),a("code",[t._v("meta.postType")]),t._v(" 都为 "),a("code",[t._v("'notice'")]),t._v("。")],1),t._v(" "),a("h3",{attrs:{id:"事件：friend-add"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：friend-add"}},[t._v("#")]),t._v(" 事件：friend-add")]),t._v(" "),a("p",[t._v("新增好友事件，会在好友上下文触发。")]),t._v(" "),a("h3",{attrs:{id:"事件：group-increase"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：group-increase"}},[t._v("#")]),t._v(" 事件：group-increase")]),t._v(" "),a("p",[t._v("群成员增加事件，会在群上下文触发。拥有下面的子事件：")]),t._v(" "),a("ul",[a("li",[t._v("group-increase/approve: 通过申请加群")]),t._v(" "),a("li",[t._v("group-increase/invite: 通过邀请加群")])]),t._v(" "),a("h3",{attrs:{id:"事件：group-decrease"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：group-decrease"}},[t._v("#")]),t._v(" 事件：group-decrease")]),t._v(" "),a("p",[t._v("群成员减少事件，会在群上下文触发。拥有下面的子事件：")]),t._v(" "),a("ul",[a("li",[t._v("group-decrease/leave: 主动退群")]),t._v(" "),a("li",[t._v("group-decrease/kick: 非登录号被踢出群")]),t._v(" "),a("li",[t._v("group-decrease/kick-me: 登录号被踢出群")])]),t._v(" "),a("h3",{attrs:{id:"事件：group-upload"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：group-upload"}},[t._v("#")]),t._v(" 事件：group-upload")]),t._v(" "),a("p",[t._v("群文件上传事件，会在群上下文触发。")]),t._v(" "),a("h3",{attrs:{id:"事件：group-admin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：group-admin"}},[t._v("#")]),t._v(" 事件：group-admin")]),t._v(" "),a("p",[t._v("群管理员变动事件，会在群上下文触发。拥有下面的子事件：")]),t._v(" "),a("ul",[a("li",[t._v("group-admin/set: 设置管理员")]),t._v(" "),a("li",[t._v("group-admin/unset: 取消管理员")])]),t._v(" "),a("h3",{attrs:{id:"事件：group-ban"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：group-ban"}},[t._v("#")]),t._v(" 事件：group-ban")]),t._v(" "),a("p",[t._v("群禁言变动事件，会在群上下文触发。拥有下面的子事件：")]),t._v(" "),a("ul",[a("li",[t._v("group-admin/ban: 禁言")]),t._v(" "),a("li",[t._v("group-admin/lift-ban: 解除禁言")])]),t._v(" "),a("h2",{attrs:{id:"metaevent-系列事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#metaevent-系列事件"}},[t._v("#")]),t._v(" metaEvent 系列事件")]),t._v(" "),a("p",[t._v("metaEvent 系列事件对应这 CQHTTP 插件本身的元事件，"),a("strong",[t._v("只会在 App 实例触发")]),t._v("。所有这些事件的回调函数都会传入一个 "),a("RouterLink",{attrs:{to:"/guide/message.html#深入-meta-对象"}},[a("code",[t._v("Meta")]),t._v(" 对象")]),t._v("。这些事件的共同点是 "),a("code",[t._v("meta.postType")]),t._v(" 都为 "),a("code",[t._v("'meta_event'")]),t._v("。")],1),t._v(" "),a("h3",{attrs:{id:"事件：heartbeat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：heartbeat"}},[t._v("#")]),t._v(" 事件：heartbeat")]),t._v(" "),a("p",[t._v("心跳元事件，"),a("strong",[t._v("仅对 WebSocket 生效")]),t._v("。产生此事件需要通过将配置项 "),a("code",[t._v("enable_heartbeat")]),t._v(" 设置为 "),a("code",[t._v("true")]),t._v("，并可通过 "),a("code",[t._v("heartbeat_interval")]),t._v(" 配置心跳间隔（单位毫秒）。")]),t._v(" "),a("h3",{attrs:{id:"事件：lifecycle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：lifecycle"}},[t._v("#")]),t._v(" 事件：lifecycle")]),t._v(" "),a("p",[t._v("生命周期事件，"),a("strong",[t._v("仅对 HTTP 生效")]),t._v("。拥有下面的子事件：")]),t._v(" "),a("ul",[a("li",[t._v("lifecycle/enable: CQHTTP 插件启用")]),t._v(" "),a("li",[t._v("lifecycle/disable: CQHTTP 插件停用")]),t._v(" "),a("li",[t._v("lifecycle/connect: 成功建立 WebSocket 连接")])]),t._v(" "),a("h2",{attrs:{id:"koishi-内部事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#koishi-内部事件"}},[t._v("#")]),t._v(" Koishi 内部事件")]),t._v(" "),a("p",[t._v("以下事件与 CQHTTP 无关，是 Koishi 内部的事件。")]),t._v(" "),a("h3",{attrs:{id:"事件：before-connect"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：before-connect"}},[t._v("#")]),t._v(" 事件：before-connect")]),t._v(" "),a("p",[t._v("开始连接到服务器时在 App 实例触发。")]),t._v(" "),a("h3",{attrs:{id:"事件：connect"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：connect"}},[t._v("#")]),t._v(" 事件：connect")]),t._v(" "),a("p",[t._v("成功连接到服务器时在 App 实例触发。")]),t._v(" "),a("h3",{attrs:{id:"事件：ready"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：ready"}},[t._v("#")]),t._v(" 事件：ready")]),t._v(" "),a("p",[t._v("成功连接到服务器且已经获得 QQ 号时触发。参见 "),a("RouterLink",{attrs:{to:"/guide/lifecycle.html#ready-事件"}},[t._v("ready 事件")]),t._v("。")],1),t._v(" "),a("h3",{attrs:{id:"事件：before-group"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：before-group"}},[t._v("#")]),t._v(" 事件：before-group")]),t._v(" "),a("p",[t._v("当 Koishi 试图从数据库获取群信息前触发。调用时会传入一个 "),a("code",[t._v("Set<GroupField>")]),t._v(" 对象和一个 "),a("RouterLink",{attrs:{to:"/guide/command-system.html#parsedcommandline-对象"}},[a("code",[t._v("ParsedCommandLine")])]),t._v(" 对象。如果当前没有正在解析的指令，则该对象只会有一个 "),a("code",[t._v("meta")]),t._v(" 属性。你可以在回调函数中修改传入的字段集合，增加的字段将可以被之后的中间件获取到。")],1),t._v(" "),a("p",[t._v("如果没有配置数据库，则该事件不会触发。")]),t._v(" "),a("h3",{attrs:{id:"事件：before-user"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：before-user"}},[t._v("#")]),t._v(" 事件：before-user")]),t._v(" "),a("p",[t._v("当 Koishi 试图从数据库获取用户信息前触发。调用时会传入一个 "),a("code",[t._v("Set<UserField>")]),t._v(" 对象和一个 "),a("RouterLink",{attrs:{to:"/guide/command-system.html#parsedcommandline-对象"}},[a("code",[t._v("ParsedCommandLine")])]),t._v(" 对象。如果当前没有正在解析的指令，则该对象只会有一个 "),a("code",[t._v("meta")]),t._v(" 属性。你可以在回调函数中修改传入的字段集合，增加的字段将可以被之后的中间件获取到。")],1),t._v(" "),a("p",[t._v("如果没有配置数据库，则该事件不会触发。")]),t._v(" "),a("h3",{attrs:{id:"事件：attach"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：attach"}},[t._v("#")]),t._v(" 事件：attach "),a("Badge",{attrs:{type:"error",text:"deprecated"}})],1),t._v(" "),a("p",[t._v("请使用 "),a("a",{attrs:{href:"#%E4%BA%8B%E4%BB%B6%EF%BC%9Aattach-user"}},[t._v("attach-user")]),t._v(" 事件。")]),t._v(" "),a("h3",{attrs:{id:"事件：attach-group"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：attach-group"}},[t._v("#")]),t._v(" 事件：attach-group "),a("Badge",{attrs:{text:"1.10.0+"}})],1),t._v(" "),a("p",[t._v("当 Koishi 完成群数据获取后触发。调用时会传入一个 Meta 对象，将会拥有 "),a("code",[t._v("$group")]),t._v(" 属性。你可以在回调函数中对这两个属性做同步的修改（注意：只能是同步的修改）。这些修改会在后续过程中自动更新到数据库。")]),t._v(" "),a("p",[t._v("如果没有配置数据库或不是群聊消息，则该事件不会触发。")]),t._v(" "),a("h3",{attrs:{id:"事件：attach-user"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：attach-user"}},[t._v("#")]),t._v(" 事件：attach-user "),a("Badge",{attrs:{text:"1.10.0+"}})],1),t._v(" "),a("p",[t._v("当 Koishi 完成用户数据获取后触发。调用时会传入一个 Meta 对象，将会拥有 "),a("code",[t._v("$user")]),t._v(" 属性（如果是群消息则还会拥有 "),a("code",[t._v("$group")]),t._v(" 属性）。你可以在回调函数中对这两个属性做同步的修改（注意：只能是同步的修改）。这些修改会在后续过程中自动更新到数据库。")]),t._v(" "),a("p",[t._v("如果没有配置数据库，则该事件不会触发。")]),t._v(" "),a("h3",{attrs:{id:"事件：before-send"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：before-send"}},[t._v("#")]),t._v(" 事件：before-send")]),t._v(" "),a("p",[t._v("准备发送信息时会在对应的上下文触发。调用时会传入一个伪 Meta 对象，拥有与 "),a("RouterLink",{attrs:{to:"/guide/message.html#深入-meta-对象"}},[a("code",[t._v("Meta")])]),t._v(" 对象类似的结构，但是 "),a("code",[t._v("postType")]),t._v(" 字段为 "),a("code",[t._v("send")]),t._v("。")],1),t._v(" "),a("h3",{attrs:{id:"事件：send"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：send"}},[t._v("#")]),t._v(" 事件：send")]),t._v(" "),a("p",[t._v("成功发送信息时会在对应的上下文触发。调用时会传入一个伪 Meta 对象，比 "),a("code",[t._v("before-send")]),t._v(" 事件传入的对象多出一个 "),a("code",[t._v("messageId")]),t._v(" 属性。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("注意只有非异步 Sender API 成功调用会触发此事件，而异步调用和快速回复都只会触发 "),a("code",[t._v("before-send")]),t._v(" 事件，因此你在实际使用中可能更需要上一个事件。")])]),t._v(" "),a("h3",{attrs:{id:"事件：before-command"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：before-command"}},[t._v("#")]),t._v(" 事件：before-command")]),t._v(" "),a("p",[t._v("调用指令前会在对应的上下文触发。此时指令的可用性还未经检测，因此可能出现参数错误、权限不足、超过使用次数等情况。调用时传入一个 "),a("RouterLink",{attrs:{to:"/guide/command-system.html#parsedcommandline-对象"}},[a("code",[t._v("ParsedCommandLine")])]),t._v(" 对象。")],1),t._v(" "),a("h3",{attrs:{id:"事件：command"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：command"}},[t._v("#")]),t._v(" 事件：command")]),t._v(" "),a("p",[t._v("执行指令的 "),a("code",[t._v("action")]),t._v(" 回调函数前会在对应的上下文触发。调用时传入一个 "),a("RouterLink",{attrs:{to:"/guide/command-system.html#parsedcommandline-对象"}},[a("code",[t._v("ParsedCommandLine")])]),t._v(" 对象。")],1),t._v(" "),a("h3",{attrs:{id:"事件：after-middleware"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：after-middleware"}},[t._v("#")]),t._v(" 事件：after-middleware")]),t._v(" "),a("p",[t._v("在执行完全部中间件后会在对应的上下文触发。调用时传入一个 "),a("RouterLink",{attrs:{to:"/guide/message.html#深入-meta-对象"}},[a("code",[t._v("Meta")])]),t._v(" 对象。")],1),t._v(" "),a("h3",{attrs:{id:"事件：before-disconnect"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：before-disconnect"}},[t._v("#")]),t._v(" 事件：before-disconnect")]),t._v(" "),a("p",[t._v("关闭服务器前在 App 实例触发。")]),t._v(" "),a("h3",{attrs:{id:"事件：disconnect"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件：disconnect"}},[t._v("#")]),t._v(" 事件：disconnect")]),t._v(" "),a("p",[t._v("成功关闭服务器时在 App 实例触发。")])],1)}),[],!1,null,null,null);e.default=r.exports}}]);