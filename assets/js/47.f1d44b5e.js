(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{385:function(t,a,s){"use strict";s.r(a);var o=s(25),c=Object(o.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"自然语言处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自然语言处理"}},[t._v("#")]),t._v(" 自然语言处理 (NLP)")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("本章介绍的功能由 koishi-plugin-nlp 插件提供。")])]),t._v(" "),s("p",[t._v("koishi-plugin-nlp 提供了一种将自然语言转化成指令调用的方式。换句话说，就是"),s("strong",[t._v("从用户的任意消息中识别出意图，并交由对应的指令进行执行")]),t._v("。用一张图表示它的工作原理就是这样：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/nlp-example.png",alt:"nlp-example"}})]),t._v(" "),s("h2",{attrs:{id:"使用方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用方法"}},[t._v("#")]),t._v(" 使用方法")]),t._v(" "),s("p",[t._v("首先安装插件：")]),t._v(" "),s("panel-view",{staticClass:"code",attrs:{title:""}},[s("pre",{staticClass:"shiki",staticStyle:{"background-color":"#272822"}},[s("code",[s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("npm i koishi-plugin-nlp")]),t._v("\n"),s("span",{staticStyle:{color:"#75715E"}},[t._v("# 或者")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("yarn add koishi-plugin-nlp")])])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("这个插件使用了著名的 "),s("a",{attrs:{href:"https://github.com/yanyiwu/nodejieba",target:"_blank",rel:"noopener noreferrer"}},[t._v("结巴分词"),s("OutboundLink")],1),t._v(" 的 NodeJS 绑定。如果安装失败可能是缺少一些运行环境导致的。")])]),t._v(" "),s("p",[t._v("接着使用这个插件：")]),t._v(" "),s("panel-view",{staticClass:"code",attrs:{title:""}},[s("pre",{staticClass:"shiki",staticStyle:{"background-color":"#272822"}},[s("code",[s("span",{staticStyle:{color:"#75715E"}},[t._v("// 注册插件")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("ctx.")]),s("span",{staticStyle:{color:"#A6E22E"}},[t._v("plugin")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),s("span",{staticStyle:{color:"#66D9EF"}},[t._v("require")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'koishi-plugin-nlp'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("))")]),t._v("\n\n"),s("span",{staticStyle:{color:"#75715E"}},[t._v("// 假设我们写了这样一个指令")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("ctx.")]),s("span",{staticStyle:{color:"#A6E22E"}},[t._v("command")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'weather <location>'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", ")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'查天气'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(")")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),s("span",{staticStyle:{color:"#75715E"}},[t._v("// 插件会在 Command 实例中添加一个 intend 方法")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),s("span",{staticStyle:{color:"#75715E"}},[t._v("// 传入的第一个参数是要匹配的关键字")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),s("span",{staticStyle:{color:"#75715E"}},[t._v("// 第二个参数是一个函数，当匹配到关键字时会执行")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  .")]),s("span",{staticStyle:{color:"#A6E22E"}},[t._v("intend")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'天气'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", (")]),s("span",{staticStyle:{color:"#FD971F"}},[t._v("meta")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(") ")]),s("span",{staticStyle:{color:"#66D9EF"}},[t._v("=>")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    ")]),s("span",{staticStyle:{color:"#75715E"}},[t._v("// 插件会在 meta.$parsed 对象中添加一个 tags 属性")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    ")]),s("span",{staticStyle:{color:"#75715E"}},[t._v("// 这里的 ns 表示词性为地名")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    ")]),s("span",{staticStyle:{color:"#66D9EF"}},[t._v("const")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" tag ")]),s("span",{staticStyle:{color:"#F92672"}},[t._v("=")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" meta.$parsed.tags.")]),s("span",{staticStyle:{color:"#66D9EF"}},[t._v("find")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(({ ")]),s("span",{staticStyle:{color:"#FD971F"}},[t._v("tag")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" }) ")]),s("span",{staticStyle:{color:"#66D9EF"}},[t._v("=>")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" tag ")]),s("span",{staticStyle:{color:"#F92672"}},[t._v("===")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'ns'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(")")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    ")]),s("span",{staticStyle:{color:"#75715E"}},[t._v("// 返回一个置信度为 0.9 的结果")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    ")]),s("span",{staticStyle:{color:"#75715E"}},[t._v("// 执行时的第一个参数取匹配到的词")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    ")]),s("span",{staticStyle:{color:"#F92672"}},[t._v("if")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" (tag) ")]),s("span",{staticStyle:{color:"#F92672"}},[t._v("return")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" { confidence: ")]),s("span",{staticStyle:{color:"#AE81FF"}},[t._v("0.9")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", args: [tag.word] }")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  })")])])])]),s("p",[t._v("现在，向你的机器人发送“今天南京的天气如何”，机器人就会自动使用“南京”作为参数，调用 weather 这个指令了。")]),t._v(" "),s("h2",{attrs:{id:"运作原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运作原理"}},[t._v("#")]),t._v(" 运作原理")]),t._v(" "),s("p",[t._v("现在让我们回顾一下上面的示例，来看看这个插件到底是如何工作的。")]),t._v(" "),s("h3",{attrs:{id:"cmd-intend"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cmd-intend"}},[t._v("#")]),t._v(" cmd.intend()")]),t._v(" "),s("p",[t._v("首先，插件向 Command 示例添加了一个 "),s("code",[t._v("intend()")]),t._v(" 方法，这个方法的作用是当检测到输入的句子中存在“天气”一词时进行匹配，预测出一个该指令的调用概率来。这个方法的回调函数返回一个对象，这个对象可以拥有下面的属性：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("args:")]),t._v(" "),s("code",[t._v("string[]")]),t._v(" 由全部参数构成的数组")]),t._v(" "),s("li",[s("strong",[t._v("options:")]),t._v(" "),s("code",[t._v("Record<string, any>")]),t._v(" 由传入选项构成的键值对")]),t._v(" "),s("li",[s("strong",[t._v("rest:")]),t._v(" "),s("code",[t._v("string")]),t._v(" 额外参数的内容")]),t._v(" "),s("li",[s("strong",[t._v("confidence:")]),t._v(" "),s("code",[t._v("number")]),t._v(" 一个 0 到 1 之间的数，表示置信度")])]),t._v(" "),s("p",[t._v("如果你对指令系统那一章还比较熟悉的话，就不难发现前三个参数也出现在了 "),s("RouterLink",{attrs:{to:"/guide/command-system.html#parsedcommandline-对象"}},[s("code",[t._v("ParsedCommandLine")]),t._v(" 对象")]),t._v(" 中。而最后一个参数表示的是置信度，置信度越高表示你越认为这句话表达了调用该指令的意图。而这又如何体现呢？很简单，如果一句输入同时触发了多个回调函数，则插件只会取返回的置信度最高的那个执行。")],1),t._v(" "),s("p",[t._v("如果回调函数没有任何返回，或者返回了一个过低的置信度，则插件不会触发对应的指令。而在上面的例子中，如果 "),s("code",[t._v("tag")]),t._v(" 存在，则返回了一个置信度为 0.9 的对象，否则不返回，这也表示只有当 "),s("code",[t._v("tag")]),t._v(" 成功找到后插件才可能会调用查天气的指令。")]),t._v(" "),s("h3",{attrs:{id:"meta-parsed-tags"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#meta-parsed-tags"}},[t._v("#")]),t._v(" meta.$parsed.tags")]),t._v(" "),s("p",[t._v("同上面所说的 "),s("code",[t._v("cmd.intend()")]),t._v(" 类似，"),s("code",[t._v("meta.$parsed.tags")]),t._v(" 也是插件添加的属性。它表达了输入的句子的分词和词性信息。例如，当输入的句子是“今天南京的天气如何”时，"),s("code",[t._v("meta.$parsed.tags")]),t._v(" 将会有下面的内容：")]),t._v(" "),s("panel-view",{staticClass:"code",attrs:{title:""}},[s("pre",{staticClass:"shiki",staticStyle:{"background-color":"#272822"}},[s("code",[s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("[ { word: ")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'今天'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", tag: ")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'t'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" },     ")]),s("span",{staticStyle:{color:"#75715E"}},[t._v("// t (time) 时间词")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  { word: ")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'南京'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", tag: ")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'ns'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" },    ")]),s("span",{staticStyle:{color:"#75715E"}},[t._v("// n (noun) 名词，ns (space) 地名")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  { word: ")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'的'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", tag: ")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'uj'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" },      ")]),s("span",{staticStyle:{color:"#75715E"}},[t._v("// u (auxiliary) 助词，uj 助词的")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  { word: ")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'天气'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", tag: ")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'n'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" },     ")]),s("span",{staticStyle:{color:"#75715E"}},[t._v("// n (noun) 名词")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  { word: ")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'如何'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", tag: ")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'r'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" } ]    ")]),s("span",{staticStyle:{color:"#75715E"}},[t._v("// r (pronoun) 代词")])])])]),s("p",[t._v("这样一来，剩下的代码也就可以理解了："),s("code",[t._v("meta.$parsed.tags.find(({ tag }) => tag === 'ns')")]),t._v(" 的作用正是找出句子中的第一个地名并作为调用的参数。")]),t._v(" "),s("h2",{attrs:{id:"配置项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置项"}},[t._v("#")]),t._v(" 配置项")]),t._v(" "),s("h3",{attrs:{id:"设置最低置信度"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置最低置信度"}},[t._v("#")]),t._v(" 设置最低置信度")]),t._v(" "),s("p",[t._v("上面已经介绍了如果返回的置信度过低则不会触发指令，那么这个边界在哪呢？对于 koishi-plugin-nlp 插件来说，默认的最低置信度为 0.5，但是你也可以手动修改这个边界值：")]),t._v(" "),s("panel-view",{staticClass:"code",attrs:{title:""}},[s("pre",{staticClass:"shiki",staticStyle:{"background-color":"#272822"}},[s("code",[s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("ctx.")]),s("span",{staticStyle:{color:"#A6E22E"}},[t._v("plugin")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),s("span",{staticStyle:{color:"#66D9EF"}},[t._v("require")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),s("span",{staticStyle:{color:"#E6DB74"}},[t._v("'koishi-plugin-nlp'")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("), {")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),s("span",{staticStyle:{color:"#75715E"}},[t._v("// 重新设置最低置信度为 0.6")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  threshold: ")]),s("span",{staticStyle:{color:"#AE81FF"}},[t._v("0.6")]),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v(",")]),t._v("\n"),s("span",{staticStyle:{color:"#F8F8F2"}},[t._v("})")])])])]),s("h3",{attrs:{id:"手动设置词库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手动设置词库"}},[t._v("#")]),t._v(" 手动设置词库")]),t._v(" "),s("p",[t._v("尽管 nodejieba 提供了内置词库，你仍然可以手动设置要使用的词库。以下是相关的配置项：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("dict:")]),t._v(" "),s("code",[t._v("string")]),t._v(" 主词典，带权重和词性标签，建议使用默认词典")]),t._v(" "),s("li",[s("strong",[t._v("hmmDict:")]),t._v(" "),s("code",[t._v("string")]),t._v(" 隐式马尔科夫模型，建议使用默认词典")]),t._v(" "),s("li",[s("strong",[t._v("userDict:")]),t._v(" "),s("code",[t._v("string")]),t._v(" 用户词典，建议自己根据需要定制")]),t._v(" "),s("li",[s("strong",[t._v("idfDict:")]),t._v(" "),s("code",[t._v("string")]),t._v(" 关键词抽取所需的 idf 信息")]),t._v(" "),s("li",[s("strong",[t._v("stopWordDict:")]),t._v(" "),s("code",[t._v("string")]),t._v(" 关键词抽取所需的停用词列表")])]),t._v(" "),s("p",[t._v("如果要设置自定义的词典，可以创建一个文本文件，将自定义的词汇一行一个地写入这个文件，然后将 "),s("code",[t._v("userDict")]),t._v(" 选项设置为该文件的路径即可。")])],1)}),[],!1,null,null,null);a.default=c.exports}}]);